<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Chapter 2: Reading from sensors &amp; exploring the Device Cloud | Particle Electron Workshop</title>
    <meta name="description" content="Workshops designed to teach the basics of IoT development with the Particle ecosystem &amp; the Particle Electron">
    
    
    <link rel="preload" href="/assets/css/5.styles.99013215.css" as="style"><link rel="preload" href="/assets/js/app.5353aa60.js" as="script"><link rel="preload" href="/assets/js/1.a58f505a.js" as="script"><link rel="prefetch" href="/assets/js/0.76f712ed.js"><link rel="prefetch" href="/assets/js/2.85f96e7f.js"><link rel="prefetch" href="/assets/js/3.001fd918.js"><link rel="prefetch" href="/assets/js/4.a79e4a19.js">
    <link rel="stylesheet" href="/assets/css/5.styles.99013215.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><!----><span class="site-name">
      Particle Electron Workshop
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="http://particle.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Team
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><a href="https://github.com/particle-iot/workshop-continental-tire" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="http://particle.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Team
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><a href="https://github.com/particle-iot/workshop-continental-tire" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav><ul class="sidebar-links"><li><a href="/docs/" class="sidebar-link">About Particle Workshops</a></li><li><a href="/docs/ch1.html" class="sidebar-link">Chapter 1: Getting your Electron device online</a></li><li><a href="/docs/ch2.html" class="active sidebar-link">Chapter 2: Reading from Sensors &amp; exploring the Device Cloud</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/ch2.html#create-a-new-project-in-the-web-ide" class="sidebar-link">Create a new project in the Web IDE</a></li><li class="sidebar-sub-header"><a href="/docs/ch2.html#the-setup-and-loop-functions" class="sidebar-link">The setup() and loop() functions</a></li><li class="sidebar-sub-header"><a href="/docs/ch2.html#setting-up-the-iaqm-board" class="sidebar-link">Setting up the IAQM Board</a></li><li class="sidebar-sub-header"><a href="/docs/ch2.html#working-with-the-temperature-humidity-sensor" class="sidebar-link">Working with the Temperature &amp; Humidity Sensor</a></li><li class="sidebar-sub-header"><a href="/docs/ch2.html#working-with-the-gas-sensor" class="sidebar-link">Working with the Gas Sensor</a></li><li class="sidebar-sub-header"><a href="/docs/ch2.html#working-with-the-dust-sensor" class="sidebar-link">Working with the Dust Sensor</a></li><li class="sidebar-sub-header"><a href="/docs/ch2.html#working-with-the-light-sensor" class="sidebar-link">Working with the Light Sensor</a></li><li class="sidebar-sub-header"><a href="/docs/ch2.html#working-with-the-motion-sensor" class="sidebar-link">Working with the Motion Sensor</a></li></ul></li><li><a href="/docs/ch3.html" class="sidebar-link">Chapter 3: Using IFTTT &amp; Azure IoT Hub</a></li></ul></div><div class="page"><div class="content"><h1 id="chapter-2-reading-from-sensors-exploring-the-device-cloud"><a href="#chapter-2-reading-from-sensors-exploring-the-device-cloud" aria-hidden="true" class="header-anchor">#</a> Chapter 2: Reading from sensors &amp; exploring the Device Cloud</h1><table><thead><tr><th><strong>Project Goal</strong></th><th>Start programming your Electron, read sensor data, and leverage the device cloud.</th></tr></thead><tbody><tr><td><strong>What you’ll learn</strong></td><td>How to interact with sensors; Using Particle variables and cloud functions.</td></tr><tr><td><strong>Tools you’ll need</strong></td><td>build.particle.io, console.particle.io, the Particle CLI, a Particle Electron and Continental IAQM Device</td></tr><tr><td><strong>Time needed to complete</strong></td><td>60 minutes</td></tr></tbody></table><p>In this session, we're going to explore the Particle ecosystem via an, Electron-powered IAQM Device with several sensors! If you get stuck at any point during this session, <a href="https://go.particle.io/shared_apps/5b92ba65df6b76d72400179f" target="_blank" rel="noopener noreferrer">click here for the completed, working source<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p><h2 id="create-a-new-project-in-the-web-ide"><a href="#create-a-new-project-in-the-web-ide" aria-hidden="true" class="header-anchor">#</a> Create a new project in the Web IDE</h2><ol><li>Navigate to <a href="http://build.particle.io" target="_blank" rel="noopener noreferrer">build.particle.io<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. You may need to log-in, if prompted.</li></ol><p><img src="/assets/img/login.612397f2.png" alt></p><ol start="2"><li>Once you log-in, you may be directed to the Particle home page. If so, <a href="https://build.particle.io" target="_blank" rel="noopener noreferrer">click here to navigate<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> back to Particle Build.</li></ol><p><img src="/assets/img/particle-home.a4565b9c.png" alt></p><ol start="3"><li>When navigating to the Web IDE (Build), the first thing you'll see is an empty editor window for a new project and a prompt to give that project a name.</li></ol><p><img src="/assets/img/newproject.68e3a433.png" alt></p><ol start="4"><li>In the Current App textbox, give your app the name &quot;IAQMSensors&quot; and hit enter.</li></ol><p><img src="/assets/img/projectname.ccb604b4.png" alt></p><ol start="5"><li>Once you've given your project a name, you're ready to code!</li></ol><p><img src="/assets/img/projectnamed.c7cf880b.png" alt></p><h2 id="the-setup-and-loop-functions"><a href="#the-setup-and-loop-functions" aria-hidden="true" class="header-anchor">#</a> The <code>setup()</code> and <code>loop()</code> functions</h2><p>Before we dive into our first bit of code, a brief word about the two functions that were auto-populated into your new app. If you've done Arduino or Particle development before, you're already familiar with these and can skip ahead. If not, read on.</p><p>Every Particle application <em>must</em> have two functions in the main file (sometimes called a &quot;sketch&quot;): <code>setup()</code> and <code>loop()</code>. Both of these functions are called by the Particle Device OS.</p><p>True to its name, <code>setup()</code> runs only only once when the device starts up and is used for initializing buttons, sensors and other things needed to get your project ready to execute.</p><p><code>loop()</code>, on the other hand, runs over and over again as long as your firmware is running on the device. When the function is called by the device OS, the code inside executes sequentially until it reaches the closing brace of the function, before being called again.</p><p>While the speed at which the <code>loop()</code> function executes is determined by the specific hardware and the time needed to execute the use code you've written in the function, it's important to know that, much of the time, this function will run very fast.</p><p>The bulk of your program, from state management, handling user input, reading from sensors and more will take place inside of the <code>loop()</code> function. It can take a bit of getting used to if you're not familiar with this style of development, but once you become comfortable, you'll enjoy the power this control provides you as a firmware developer.</p><h2 id="setting-up-the-iaqm-board"><a href="#setting-up-the-iaqm-board" aria-hidden="true" class="header-anchor">#</a> Setting up the IAQM Board</h2><ol><li>The project box you received contains a custom PCB with a slot for a Particle Electron and several Grove-compatible breakouts for Digital and Analog pins, as well as the I2C bus on the Electron.</li></ol><p><img src="/assets/img/iaqmpcb.01c0131d.jpg" alt></p><ol start="2"><li>Plug your Electron into the slot on the board, making sure to line up the device to the silkscreen outline. Leave the Electron plugged into your computer via USB, and the LiPo battery connected.</li></ol><p><img src="/assets/img/electroninslot.df3fe1e5.jpg" alt></p><ol start="3"><li>Next, make sure you have the five Grove sensors we'll need for this lab. They are:</li></ol><ul><li>SHT31 Temperature &amp; Humidity Sensor</li><li>SGP30 VOC and eCO2 Gas Sensor</li><li>Dust Sensor</li><li>Light sensor</li><li>PIR Motion Sensor</li></ul><p><img src="/assets/img/grovesensors.cd98ca73.jpg" alt></p><h2 id="working-with-the-temperature-humidity-sensor"><a href="#working-with-the-temperature-humidity-sensor" aria-hidden="true" class="header-anchor">#</a> Working with the Temperature &amp; Humidity Sensor</h2><h3 id="add-the-sht31-library"><a href="#add-the-sht31-library" aria-hidden="true" class="header-anchor">#</a> Add the SHT31 Library</h3><ol><li>Find the Temperature &amp; Humidity Sensor.</li></ol><p><img src="/assets/img/temphusensor.9662c144.jpg" alt></p><ol start="2"><li>The bag includes a sensor and a four-wire cable for connecting the sensor to the board. Plug one side of the cable into the slot on the sensor PCB.</li></ol><p><img src="/assets/img/tempwire.c02af73b.jpg" alt></p><ol start="3"><li>Plug the other end into any of the white connectors with an &quot;I2C&quot; label next to it.</li></ol><p><img src="/assets/img/temppluggedin.4c175466.jpg" alt></p><p>Once connected, you're ready to start reading from this sensor!</p><p><img src="/assets/img/tempandelectron.965c1452.jpg" alt></p><ol start="4"><li>Since the SHT31 temperature and humidity sensor is a common device, we can use a library to work with it. Navigate to your project at <a href="https://build.particle.io" target="_blank" rel="noopener noreferrer">build.particle.io<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> and click on the bookmark icon to open the libraries tab.</li></ol><p><img src="/assets/img/libraries.6555812e.png" alt></p><ol start="5"><li>Type &quot;SHT31&quot; into the search box. The library we'll be using should match that name exactly.</li></ol><p><img src="/assets/img/librarysearch.b3967ec5.png" alt></p><ol start="6"><li>Click on the library name in search results, which will bring up the description page and source code. Click the &quot;Include in project&quot; button.</li></ol><p><img src="/assets/img/sht31.b92e2fc7.png" alt></p><ol start="7"><li>Select your &quot;IAQMSensors&quot; project.</li></ol><p><img src="/assets/img/whichapp.20c29388.png" alt></p><ol start="8"><li>Click &quot;Confirm.&quot;</li></ol><p><img src="/assets/img/confirm.bb674200.png" alt></p><ol start="9"><li>The library will be included in your app, which you'll see in the sidebar. Also notice that an #include statement was added for the header file for the library.</li></ol><p><img src="/assets/img/libraryadded.c445b255.png" alt></p><h3 id="interact-with-the-sensor"><a href="#interact-with-the-sensor" aria-hidden="true" class="header-anchor">#</a> Interact with the sensor</h3><ol><li>First, we'll need to add a global variable to hold the sensor class object. Add the following to the top of your program, outside of the <code>setup</code> and <code>loop</code> methods.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code>SHT31 sht31 <span class="token operator">=</span> <span class="token function">SHT31</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="2"><li>Let's also create two variables to hold the temperature and humidity, just below that object.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> currentTemperature<span class="token punctuation">;</span>
<span class="token keyword">int</span> currentHumidity<span class="token punctuation">;</span>
</code></pre></div><ol start="3"><li>Now, we'll call the <code>begin</code> class method to initialize the sensor for reading. Add the following to your <code>setup</code> function.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code>sht31<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="4"><li>We're ready to read from the sensor. In the <code>loop</code> function, add the following two lines to set the temp and humidity variables.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code>currentTemperature <span class="token operator">=</span> <span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">(</span>sht31<span class="token punctuation">.</span><span class="token function">getTemperature</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1.8</span> <span class="token operator">+</span> <span class="token number">32.00</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">10</span><span class="token punctuation">;</span>
currentHumidity <span class="token operator">=</span> <span class="token function">round</span><span class="token punctuation">(</span>sht31<span class="token punctuation">.</span><span class="token function">getHumidity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">10</span><span class="token punctuation">;</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>The <code>getTemperature</code> method returns the temp as a Celcius value, so we multiply that value by 1.8 and add 32 to convert it to Fahrenheit. Both methods also return float values, so we'll do a bit of math to round them and cast each value to an integer.</p></div><ol start="5"><li>As stated above, the loop function runs very fast. So fast, in fact, that if your loop only contained the two statements to check the sensor value, the values would be updated faster than you can use them. One of the ways we can manage this is with the delay() function, which accepts a value that represents the number of milliseconds to pause before continuing program execution. Add the following to the end of the <code>loop</code> function.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="6"><li>We're getting sensor data now, but we don't have a way to read it, yet. Let's use our first Particle Device Cloud primitive and expose these as variables. The <code>Particle.variable</code> method requires two parameters, a String representing the name of the variable and the global variable to return whenever the variable is requested from the device cloud. Variables must be declared in the <code>setup</code> function, so add the following two lines to the end.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code>Particle<span class="token punctuation">.</span><span class="token function">variable</span><span class="token punctuation">(</span><span class="token string">&quot;tempF&quot;</span><span class="token punctuation">,</span> currentTemperature<span class="token punctuation">)</span><span class="token punctuation">;</span>
Particle<span class="token punctuation">.</span><span class="token function">variable</span><span class="token punctuation">(</span><span class="token string">&quot;humidity&quot;</span><span class="token punctuation">,</span> currentHumidity<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="7"><li>You full code file should now look like this.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;SHT31.h&gt;</span></span>

SHT31 sht31 <span class="token operator">=</span> <span class="token function">SHT31</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> currentTemperature<span class="token punctuation">;</span>
<span class="token keyword">int</span> currentHumidity<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  sht31<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  Particle<span class="token punctuation">.</span><span class="token function">variable</span><span class="token punctuation">(</span><span class="token string">&quot;tempF&quot;</span><span class="token punctuation">,</span> currentTemperature<span class="token punctuation">)</span><span class="token punctuation">;</span>
  Particle<span class="token punctuation">.</span><span class="token function">variable</span><span class="token punctuation">(</span><span class="token string">&quot;humidity&quot;</span><span class="token punctuation">,</span> currentHumidity<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  currentTemperature <span class="token operator">=</span> <span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">(</span>sht31<span class="token punctuation">.</span><span class="token function">getTemperature</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1.8</span> <span class="token operator">+</span> <span class="token number">32.00</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">10</span><span class="token punctuation">;</span>
  currentHumidity <span class="token operator">=</span> <span class="token function">round</span><span class="token punctuation">(</span>sht31<span class="token punctuation">.</span><span class="token function">getHumidity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">10</span><span class="token punctuation">;</span>

  <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="7"><li>To see your first code in action, we need to install the code on a device. This is often referred to as &quot;flashing firmware&quot;. In the bottom-left corner of the Web IDE, click on the cross-hairs icon to open the devices panel.</li></ol><p><img src="/assets/img/devices.6a952842.png" alt></p><ol start="8"><li>The Devices panel shows a list of all the Particle devices you own, organized by type. Online devices will include a breathing cyan dot next to the name, as well.</li></ol><p><img src="/assets/img/deviceslist.908c0d63.png" alt></p><ol start="9"><li>To choose a device to flash, click the start next to the name of the device you want to flash.</li></ol><p><img src="/assets/img/selecttoflash.e4855d19.png" alt></p><ol start="10"><li>Now, click the flash lightning bolt icon in the top-left to flash the firmware to your device.</li></ol><p><img src="/assets/img/lightning.34844474.png" alt></p><h3 id="view-readings-in-the-particle-console"><a href="#view-readings-in-the-particle-console" aria-hidden="true" class="header-anchor">#</a> View Readings in the Particle Console</h3><ol><li>Open a new browser tab and navigate to <a href="https://console.particle.io" target="_blank" rel="noopener noreferrer">console.particle.io<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. Find your Electron and click on it's ID.</li></ol><p><img src="/assets/img/console.508640a8.png" alt></p><ol start="2"><li>The device dashboard is your command-center for your Electron. It shows an event log, device diagnostics and more.</li></ol><p><img src="/assets/img/dash.f7a0a0c8.png" alt></p><ol start="3"><li>In the right-hand side of the screen, you'll see a section for Device Cloud functions and variables you device has set up. Your two variables should show up here.</li></ol><p><img src="/assets/img/funcsandvars.ec5623b7.png" alt></p><ol start="4"><li>Click the &quot;Get&quot; button next to each variable and you should see the latest temperature and humidity readings from your Electron.</li></ol><p><img src="/assets/img/variables.029467c9.png" alt></p><p>Congrats, you've configured your first sensor, and have successfully pushed it's data to the cloud. Now let's add the next sensor and explore more of the Particle Device Cloud.</p><h2 id="working-with-the-gas-sensor"><a href="#working-with-the-gas-sensor" aria-hidden="true" class="header-anchor">#</a> Working with the Gas Sensor</h2><h3 id="add-the-sgp30-library"><a href="#add-the-sgp30-library" aria-hidden="true" class="header-anchor">#</a> Add the SGP30 Library</h3><ol><li>Find the Gas Sensor.</li></ol><p><img src="/assets/img/gassensor.467d7d3b.jpg" alt></p><ol start="2"><li>The bag includes a sensor and a four-wire cable for connecting the sensor to the board. Plug one side of the cable into the slot on the sensor PCB.</li></ol><p><img src="/assets/img/gaspluggedin.69ef123e.jpg" alt></p><ol start="3"><li>Plug the other end into any of the white connectors with an &quot;I2C&quot; label next to it.</li></ol><p><img src="/assets/img/gasandelectron.9e5a31ef.jpg" alt></p><p>Once connected, you're ready to start reading from this sensor!</p><p><img src="/assets/img/gasandtemp.b2773a00.jpg" alt></p><ol start="4"><li><p>Just like with the Temp and humidity sensor, we can read the gas sensor with a library. Open your project at build.particle.io and open the libraries tab.</p></li><li><p>Type &quot;SGP30&quot; into the search box. The Library we're looking for is named &quot;SensirionSGP30.&quot;</p></li></ol><p><img src="/assets/img/sgp30lib.06f49982.png" alt></p><ol start="6"><li>Click the library name, then &quot;Include in Project.&quot; Select your current project and click &quot;Confirm.&quot; You should now see two libraries included in your project.</li></ol><p><img src="/assets/img/twolibraries.5434e515.png" alt></p><h3 id="interacting-with-the-device"><a href="#interacting-with-the-device" aria-hidden="true" class="header-anchor">#</a> Interacting with the device</h3><ol><li>As we did with the temp sensor, we need to initialize a class object to interface with our sensor. Add the following below the object initialization code for the temp sensor.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code>SensirionSGP30 sgp<span class="token punctuation">;</span>
</code></pre></div><ol start="2"><li>The Gas sensor reads two values, <a href="https://en.wikipedia.org/wiki/Volatile_organic_compound" target="_blank" rel="noopener noreferrer">Total Volatile Organic Compounds<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> (TVOC) in parts per million (ppm) and <a href="https://climatepolicyinfohub.eu/glossary/co2eq" target="_blank" rel="noopener noreferrer">Carbon dioxide equivalent<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> (CO2eq) in parts per billion (ppb), both of which can be used to determine air quality. Let's create global variables to hold both readings. Add them right after our temp and humidity variables.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> currentTVOC<span class="token punctuation">;</span>
<span class="token keyword">int</span> currentCO2eq<span class="token punctuation">;</span>
</code></pre></div><ol start="3"><li>Next, we'll initialize the sensor in our <code>setup</code> function.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code>sgp<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="4"><li>Then, in <code>loop</code>, we can take a reading. This library works in a slightly different fashion from the temp and humidity sensor in that both values are fetched by a single method call <code>IAQmeasure</code>, which places the readings into class variables. If the measurement is successful, the method will return <code>true</code>, so we'll check it before assigning the readings into the global variables.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>sgp<span class="token punctuation">.</span><span class="token function">IAQmeasure</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  currentTVOC <span class="token operator">=</span> sgp<span class="token punctuation">.</span>TVOC<span class="token punctuation">;</span>
  currentCO2eq <span class="token operator">=</span> sgp<span class="token punctuation">.</span>eCO2<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="5"><li>Finally, to make these values accessible to the Device Cloud, we'll add two more <code>Particle.Variable</code> calls in <code>setup</code>.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code>Particle<span class="token punctuation">.</span><span class="token function">variable</span><span class="token punctuation">(</span><span class="token string">&quot;tvoc&quot;</span><span class="token punctuation">,</span> currentTVOC<span class="token punctuation">)</span><span class="token punctuation">;</span>
Particle<span class="token punctuation">.</span><span class="token function">variable</span><span class="token punctuation">(</span><span class="token string">&quot;eCO2&quot;</span><span class="token punctuation">,</span> currentCO2eq<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Your project code should now look like the following:</p><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;SensirionSGP30.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;SHT31.h&gt;</span></span>


SHT31 sht31 <span class="token operator">=</span> <span class="token function">SHT31</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
SensirionSGP30 sgp<span class="token punctuation">;</span>

<span class="token keyword">int</span> currentTemperature<span class="token punctuation">;</span>
<span class="token keyword">int</span> currentHumidity<span class="token punctuation">;</span>
<span class="token keyword">int</span> currentTVOC<span class="token punctuation">;</span>
<span class="token keyword">int</span> currentCO2eq<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  sht31<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  sgp<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  Particle<span class="token punctuation">.</span><span class="token function">variable</span><span class="token punctuation">(</span><span class="token string">&quot;tempF&quot;</span><span class="token punctuation">,</span> currentTemperature<span class="token punctuation">)</span><span class="token punctuation">;</span>
  Particle<span class="token punctuation">.</span><span class="token function">variable</span><span class="token punctuation">(</span><span class="token string">&quot;humidity&quot;</span><span class="token punctuation">,</span> currentHumidity<span class="token punctuation">)</span><span class="token punctuation">;</span>
  Particle<span class="token punctuation">.</span><span class="token function">variable</span><span class="token punctuation">(</span><span class="token string">&quot;tvoc&quot;</span><span class="token punctuation">,</span> currentTVOC<span class="token punctuation">)</span><span class="token punctuation">;</span>
  Particle<span class="token punctuation">.</span><span class="token function">variable</span><span class="token punctuation">(</span><span class="token string">&quot;eCO2&quot;</span><span class="token punctuation">,</span> currentCO2eq<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  currentTemperature <span class="token operator">=</span> <span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">(</span>sht31<span class="token punctuation">.</span><span class="token function">getTemperature</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1.8</span> <span class="token operator">+</span> <span class="token number">32.00</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">10</span><span class="token punctuation">;</span>
  currentHumidity <span class="token operator">=</span> <span class="token function">round</span><span class="token punctuation">(</span>sht31<span class="token punctuation">.</span><span class="token function">getHumidity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">10</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>sgp<span class="token punctuation">.</span><span class="token function">IAQmeasure</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    currentTVOC <span class="token operator">=</span> sgp<span class="token punctuation">.</span>TVOC<span class="token punctuation">;</span>
    currentCO2eq <span class="token operator">=</span> sgp<span class="token punctuation">.</span>eCO2<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="6"><li>Flash the new firmware to you device and go back to your device dashboard in the Console. Click the refresh icon in the variables list and you should see two new variables. Click &quot;Get&quot; to see the latest readings.</li></ol><p><img src="/assets/img/fourvariables.293804f9.png" alt></p><h3 id="adding-a-cloud-function"><a href="#adding-a-cloud-function" aria-hidden="true" class="header-anchor">#</a> Adding a Cloud Function</h3><ol><li>So far, we've worked exclusively with Particle variables, which allow us to read current sensor values. Let's add a function that will allow us to trigger sensor readings on-demand. Along the way, we're going to clean up the existing code a bit. Start by adding the following to the top of your file, just after the <code>#include</code></li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token macro property">#<span class="token directive keyword">define</span> SENSOR_CHECK_INTERVAL 10000</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p><code>#define</code> is a text substitution pre-processor directive. It tells the compiler to replace every instance of a text value (on the left) with another value (on the right). In the case above, anywhere we use <code>SENSOR_CHECK_INTERVAL</code> will be replaced with the number <code>10000</code>. It's like using a constant, except we're not using any memory in allocating a variable for the program!</p></div><ol start="2"><li>Next, let's add a new variable we can use to track the last time we checked the sensors. Add the following line right after our other variables.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">unsigned</span> <span class="token keyword">long</span> lastSensorCheck <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
</code></pre></div><ol start="3"><li>Now, lets add a function for checking our sensors, since we'll end up needing this in a few places. Just before the <code>setup</code> function, add a new <code>checkSensors</code> function.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">checkSensors</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  currentTemperature <span class="token operator">=</span> <span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">(</span>sht31<span class="token punctuation">.</span><span class="token function">getTemperature</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1.8</span> <span class="token operator">+</span> <span class="token number">32.00</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">10</span><span class="token punctuation">;</span>
  currentHumidity <span class="token operator">=</span> <span class="token function">round</span><span class="token punctuation">(</span>sht31<span class="token punctuation">.</span><span class="token function">getHumidity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">10</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>sgp<span class="token punctuation">.</span><span class="token function">IAQmeasure</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    currentTVOC <span class="token operator">=</span> sgp<span class="token punctuation">.</span>TVOC<span class="token punctuation">;</span>
    currentCO2eq <span class="token operator">=</span> sgp<span class="token punctuation">.</span>eCO2<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="4"><li>Next, we need to clean up our loop a bit. We were using <code>delay</code> previously to pause execution between checks, but this isn't ideal because it blocks program execution. A better way to manage delays between actions in an embedded system is to use <code>millis()</code> and timing variables, like the ones we added earlier. <code>millis()</code> returns the number of milliseconds that have elapsed since your program started running, and it can be very useful when you need to manage time intervals.</li></ol><p>Change your <code>loop</code> to look like the following:</p><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">millis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> lastSensorCheck <span class="token operator">&gt;=</span> SENSOR_CHECK_INTERVAL<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    lastSensorCheck <span class="token operator">=</span> <span class="token function">millis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">checkSensors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The <code>if</code> statement is checking to see how long it's been since we took a temperature reading. Basically, if 10 seconds have elapsed (our <code>SENSOR_CHECK_INTERVAL</code> value), we'll set the <code>lastSensorCheck</code> to a new value and then check the temperature sensor.</p><ol start="5"><li>Since our first sensor check won't happen in the first 10 seconds, we can add an initial check to our <code>setup</code>.</li></ol><div class="language-cpp extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br></div><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  sht31<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  sgp<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  Particle<span class="token punctuation">.</span><span class="token function">variable</span><span class="token punctuation">(</span><span class="token string">&quot;tempF&quot;</span><span class="token punctuation">,</span> currentTemperature<span class="token punctuation">)</span><span class="token punctuation">;</span>
  Particle<span class="token punctuation">.</span><span class="token function">variable</span><span class="token punctuation">(</span><span class="token string">&quot;humidity&quot;</span><span class="token punctuation">,</span> currentHumidity<span class="token punctuation">)</span><span class="token punctuation">;</span>
  Particle<span class="token punctuation">.</span><span class="token function">variable</span><span class="token punctuation">(</span><span class="token string">&quot;tvoc&quot;</span><span class="token punctuation">,</span> currentTVOC<span class="token punctuation">)</span><span class="token punctuation">;</span>
  Particle<span class="token punctuation">.</span><span class="token function">variable</span><span class="token punctuation">(</span><span class="token string">&quot;eCO2&quot;</span><span class="token punctuation">,</span> currentCO2eq<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">checkSensors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="6"><li>Now we can add our cloud function. <code>Particle.function</code> expects a name and a local function that will handle calls from the Device Cloud. Add the following to your <code>setup</code> function.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code>Particle<span class="token punctuation">.</span><span class="token function">function</span><span class="token punctuation">(</span><span class="token string">&quot;checkSensors&quot;</span><span class="token punctuation">,</span> checkSensorsHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="7"><li>And, finally, we'll add the function. All functions to be used as cloud functions <em>MUST</em> return an <code>int</code> and take a single <code>String</code> parameter, which is why the signature is different than our <code>checkSensors</code> function.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">checkSensorsHandler</span><span class="token punctuation">(</span>String command<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">checkSensors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>For the sake of clarity, we've wrapped the existing <code>checkTemp</code> function in our cloud function handler. How could you refactor this so we've only have one helper function for local calls and the device cloud?</p></div><p>Your firmware should now look like this.</p><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;SensirionSGP30.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;SHT31.h&gt;</span></span>

<span class="token macro property">#<span class="token directive keyword">define</span> SENSOR_CHECK_INTERVAL 10000</span>

SHT31 sht31 <span class="token operator">=</span> <span class="token function">SHT31</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
SensirionSGP30 sgp<span class="token punctuation">;</span>

<span class="token keyword">int</span> currentTemperature<span class="token punctuation">;</span>
<span class="token keyword">int</span> currentHumidity<span class="token punctuation">;</span>
<span class="token keyword">int</span> currentTVOC<span class="token punctuation">;</span>
<span class="token keyword">int</span> currentCO2eq<span class="token punctuation">;</span>
<span class="token keyword">unsigned</span> <span class="token keyword">long</span> lastSensorCheck <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">checkSensors</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  currentTemperature <span class="token operator">=</span> <span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">(</span>sht31<span class="token punctuation">.</span><span class="token function">getTemperature</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1.8</span> <span class="token operator">+</span> <span class="token number">32.00</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">10</span><span class="token punctuation">;</span>
  currentHumidity <span class="token operator">=</span> <span class="token function">round</span><span class="token punctuation">(</span>sht31<span class="token punctuation">.</span><span class="token function">getHumidity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">10</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>sgp<span class="token punctuation">.</span><span class="token function">IAQmeasure</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    currentTVOC <span class="token operator">=</span> sgp<span class="token punctuation">.</span>TVOC<span class="token punctuation">;</span>
    currentCO2eq <span class="token operator">=</span> sgp<span class="token punctuation">.</span>eCO2<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">checkSensorsHandler</span><span class="token punctuation">(</span>String command<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">checkSensors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  sht31<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  sgp<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  Particle<span class="token punctuation">.</span><span class="token function">variable</span><span class="token punctuation">(</span><span class="token string">&quot;tempF&quot;</span><span class="token punctuation">,</span> currentTemperature<span class="token punctuation">)</span><span class="token punctuation">;</span>
  Particle<span class="token punctuation">.</span><span class="token function">variable</span><span class="token punctuation">(</span><span class="token string">&quot;humidity&quot;</span><span class="token punctuation">,</span> currentHumidity<span class="token punctuation">)</span><span class="token punctuation">;</span>
  Particle<span class="token punctuation">.</span><span class="token function">variable</span><span class="token punctuation">(</span><span class="token string">&quot;tvoc&quot;</span><span class="token punctuation">,</span> currentTVOC<span class="token punctuation">)</span><span class="token punctuation">;</span>
  Particle<span class="token punctuation">.</span><span class="token function">variable</span><span class="token punctuation">(</span><span class="token string">&quot;eCO2&quot;</span><span class="token punctuation">,</span> currentCO2eq<span class="token punctuation">)</span><span class="token punctuation">;</span>

  Particle<span class="token punctuation">.</span><span class="token function">function</span><span class="token punctuation">(</span><span class="token string">&quot;checkSensors&quot;</span><span class="token punctuation">,</span> checkSensorsHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">checkSensors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">millis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> lastSensorCheck <span class="token operator">&gt;=</span> SENSOR_CHECK_INTERVAL<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    lastSensorCheck <span class="token operator">=</span> <span class="token function">millis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">checkSensors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="8"><li>Now, flash the firmware to your device and head back to the console. Refresh your device screen and you should now see your <code>checkSensors</code> function.</li></ol><p><img src="/assets/img/newFunc.2a330909.png" alt></p><ol start="9"><li>Click on <code>Call</code> to execute the function. Then, click <code>Get</code> next to the <code>tempF</code> variable to see the result.</li></ol><p><img src="/assets/img/callFunc.9454f4ce.png" alt></p><p>Let's move onto our next sensor.</p><h2 id="working-with-the-dust-sensor"><a href="#working-with-the-dust-sensor" aria-hidden="true" class="header-anchor">#</a> Working with the Dust Sensor</h2><p>The next sensor up is the Dust sensor. The included sensor uses a particle counting method to measure dust concentration and connects to a digital pin on the Electron. Once we connect this sensor, we'll add a <code>Particle.publish</code> to pass all sensor readings along to the Device cloud each time they are collected.</p><ol><li>Find the Dust sensor.</li></ol><p><img src="/assets/img/dustsensor.6a472e72.jpg" alt></p><ol start="2"><li>The bag includes a sensor and a three-wire cable for connecting the sensor to the board. Plug the larger side of the cable into the slot on the sensor PCB.</li></ol><p><img src="/assets/img/dustcable.a6213793.jpg" alt></p><ol start="3"><li>Plug the other end into the white connector with the <code>A1</code> label next to it.</li></ol><p><img src="/assets/img/dustpluggedin.ebcf94bc.jpg" alt></p><p>Once connected, you're ready to start reading from this sensor!</p><p><img src="/assets/img/threesensors.6b534937.jpg" alt></p><h3 id="interacting-with-the-device-2"><a href="#interacting-with-the-device-2" aria-hidden="true" class="header-anchor">#</a> Interacting with the device</h3><p>The dust sensor returns a Particulate Matter (PM) level (dust concentration) using a method called Low Pulse Occupancy (LPO) time in a given time unit. LPO time is proportional to PM concentration. For more information on this sensor and how it works, <a href="http://wiki.seeedstudio.com/Grove-Dust_Sensor/" target="_blank" rel="noopener noreferrer">click here<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p><ol><li>Unlike our previous two sensors, the dust sensor is not I2C based. We interact with it on a single digital pin, and need to write a bit more code to take a reading. Let's start by creating a new <code>#define</code> for the digital pin.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token macro property">#<span class="token directive keyword">define</span> DUST_SENSOR_PIN A1</span>
</code></pre></div><ol start="2"><li>Next, create some global variables to hold various readings. Add these three to the top of the file.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">unsigned</span> <span class="token keyword">long</span> duration<span class="token punctuation">;</span>
<span class="token keyword">unsigned</span> <span class="token keyword">long</span> lowPulseOccupancy<span class="token punctuation">;</span>
<span class="token keyword">float</span> ratio<span class="token punctuation">;</span>
<span class="token keyword">float</span> concentration<span class="token punctuation">;</span>
</code></pre></div><ol start="3"><li>Before we use a digital or analog pin, we need to designate it as an input or output so that our Electron knows how to properly configure the pin. Add the following line to <code>setup</code> to designate the sensor pin as an input.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token function">pinMode</span><span class="token punctuation">(</span>DUST_SENSOR_PIN<span class="token punctuation">,</span> INPUT<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="4"><li>The dust sensor operates by reading a pulse on the sensor pin over an interval. The <a href="https://docs.particle.io/reference/firmware/electron/#pulsein-" target="_blank" rel="noopener noreferrer"><code>pulseIn</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> function used here waits for the pin to be pulled low by the sensor, waits for it to go high before it stops timing and returns the length of the pulse in microseconds. By adding the following two lines to the start of our <code>loop</code>, we'll measure the duration each time through, and add it up to represent our <code>lowPulseOccupancy</code> value. Make sure these two lines appear at the very top of <code>loop</code> outside of the interval check <code>if</code> statement.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code>duration <span class="token operator">=</span> <span class="token function">pulseIn</span><span class="token punctuation">(</span>DUST_SENSOR_PIN<span class="token punctuation">,</span> LOW<span class="token punctuation">)</span><span class="token punctuation">;</span>
lowPulseOccupancy <span class="token operator">=</span> lowPulseOccupancy <span class="token operator">+</span> duration<span class="token punctuation">;</span>
</code></pre></div><ol start="5"><li>Next, we'll call a new function <code>checkDust</code> after the interval (10 sec) elapses. Your <code>loop</code> should now look like this:</li></ol><div class="language-cpp extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br></div><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  duration <span class="token operator">=</span> <span class="token function">pulseIn</span><span class="token punctuation">(</span>DUST_SENSOR_PIN<span class="token punctuation">,</span> LOW<span class="token punctuation">)</span><span class="token punctuation">;</span>
  lowPulseOccupancy <span class="token operator">=</span> lowPulseOccupancy <span class="token operator">+</span> duration<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">millis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> lastSensorCheck <span class="token operator">&gt;=</span> SENSOR_CHECK_INTERVAL<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    lastSensorCheck <span class="token operator">=</span> <span class="token function">millis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">checkSensors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">checkDust</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="6"><li>Add the <code>checkDust</code> function. The <code>lowPulseOccupancy</code> will represent the total number of microseconds that a low pulse was read over the 10 second interval, which we can use to calculate the <code>ratio</code>. <code>concentration</code> is a more complex calculation that we obtained in the <a href="http://wiki.seeedstudio.com/Grove-Dust_Sensor/" target="_blank" rel="noopener noreferrer">documentation for the sensor<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. Once we've calculated these two values, we'll reset the <code>lowPulseOccupancy</code>.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">checkDust</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  ratio <span class="token operator">=</span> lowPulseOccupancy<span class="token operator">/</span><span class="token punctuation">(</span>SENSOR_CHECK_INTERVAL<span class="token operator">*</span><span class="token number">10.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  concentration <span class="token operator">=</span> <span class="token number">1.1</span> <span class="token operator">*</span> <span class="token function">pow</span><span class="token punctuation">(</span>ratio<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">3.8</span> <span class="token operator">*</span> <span class="token function">pow</span><span class="token punctuation">(</span>ratio<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span><span class="token number">520</span> <span class="token operator">*</span> ratio <span class="token operator">+</span> <span class="token number">0.62</span><span class="token punctuation">;</span>

  lowPulseOccupancy <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="publish-a-particle-event-with-sensor-data"><a href="#publish-a-particle-event-with-sensor-data" aria-hidden="true" class="header-anchor">#</a> Publish a Particle event with sensor data</h3><p>Previously, we created variables to hold all of our sensor readings. We can continue to do this, but since the number of measurements we're tracking is starting to add up, we should consider putting the readings into an event that we can fire each time new readings are taken.</p><ol><li>Start by creating a new function called <code>fireSensorEvent</code></li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">fireSensorEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li>In order to make it easier for us to process sensor data in the next lab, we're going to create a JSON object that holds all of our sensor values. Let's create a new <code>String</code> object and assemble that object inside of the new function. Then, we'll call <code>Particle.publish</code> to send an event along to the Particle device cloud.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code>String payload <span class="token operator">=</span> <span class="token string">&quot;{\&quot;temp\&quot;:&quot;</span> <span class="token operator">+</span> <span class="token function">String</span><span class="token punctuation">(</span>currentTemperature<span class="token punctuation">)</span>
  <span class="token operator">+</span> <span class="token string">&quot;, \&quot;humidity\&quot;:&quot;</span> <span class="token operator">+</span> <span class="token function">String</span><span class="token punctuation">(</span>currentHumidity<span class="token punctuation">)</span>
  <span class="token operator">+</span> <span class="token string">&quot;, \&quot;tvoc\&quot;:&quot;</span> <span class="token operator">+</span> <span class="token function">String</span><span class="token punctuation">(</span>currentTVOC<span class="token punctuation">)</span>
  <span class="token operator">+</span> <span class="token string">&quot;, \&quot;co2eq\&quot;:&quot;</span> <span class="token operator">+</span> <span class="token function">String</span><span class="token punctuation">(</span>currentCO2eq<span class="token punctuation">)</span>
  <span class="token operator">+</span> <span class="token string">&quot;, \&quot;dust\&quot;: {\&quot;lpo\&quot;:&quot;</span> <span class="token operator">+</span> <span class="token function">String</span><span class="token punctuation">(</span>lowPulseOccupancy<span class="token punctuation">)</span>
  <span class="token operator">+</span> <span class="token string">&quot;, \&quot;ratio\&quot;:&quot;</span> <span class="token operator">+</span> <span class="token function">String</span><span class="token punctuation">(</span>ratio<span class="token punctuation">)</span>
  <span class="token operator">+</span> <span class="token string">&quot;, \&quot;concentration\&quot;:&quot;</span> <span class="token operator">+</span> <span class="token function">String</span><span class="token punctuation">(</span>concentration<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;}&quot;</span>
  <span class="token operator">+</span> <span class="token string">&quot;}&quot;</span><span class="token punctuation">;</span>

Particle<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token string">&quot;device_sensors&quot;</span><span class="token punctuation">,</span> payload<span class="token punctuation">,</span> MY_DEVICES<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="3"><li>To call this function, add it to the end of the loop, just after <code>checkDust</code>.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token function">fireSensorEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="4"><li>Flash the firmware to your device. Once loaded, navigate back to your device dashboard in the Console. Your new event should show up in the event stream after a few seconds.</li></ol><p><img src="/assets/img/sensorevents.2b52197a.png" alt></p><p>That's three sensors down and two to go! Let's look at the light sensor next.</p><h2 id="working-with-the-light-sensor"><a href="#working-with-the-light-sensor" aria-hidden="true" class="header-anchor">#</a> Working with the Light Sensor</h2><ol><li>Find the Light sensor.</li></ol><p><img src="/assets/img/lightsensor.0026483b.jpg" alt></p><ol start="2"><li>The bag includes a sensor and a four-wire cable for connecting the sensor to the board. Plug the larger side of the cable into the slot on the sensor PCB.</li></ol><p><img src="/assets/img/lightplug.67de6c89.jpg" alt></p><ol start="3"><li>Plug the other end into the white connector with the <code>A0</code> label next to it.</li></ol><p><img src="/assets/img/lightpluggedin.1d240b04.jpg" alt></p><p>Once connected, you're ready to start reading from this sensor!</p><p><img src="/assets/img/foursensors.d75dff02.jpg" alt></p><h3 id="interacting-with-the-device-3"><a href="#interacting-with-the-device-3" aria-hidden="true" class="header-anchor">#</a> Interacting with the device</h3><ol><li>Start by adding a new <code>#define</code> mapping for our light sensor at the top of your code.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token macro property">#<span class="token directive keyword">define</span> LIGHT_SENSOR_PIN A0</span>
</code></pre></div><ol start="2"><li>Next, add a <code>pinMode</code> mapping in <code>setup</code>.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token function">pinMode</span><span class="token punctuation">(</span>LIGHT_SENSOR_PIN<span class="token punctuation">,</span> INPUT<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="3"><li>As we've done previously, we'll also need a global variable to hold the light level.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">double</span> currentLightLevel<span class="token punctuation">;</span>
</code></pre></div><ol start="4"><li>In the <code>checkSensors</code> function, add a couple of lines to read the analog value from the sensor, and map that value (which could be between <code>0</code> and <code>4095</code>) to a value between <code>0</code> and <code>100</code> to loosely represent a percentage.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">double</span> lightAnalogVal <span class="token operator">=</span> <span class="token function">analogRead</span><span class="token punctuation">(</span>LIGHT_SENSOR_PIN<span class="token punctuation">)</span><span class="token punctuation">;</span>
currentLightLevel <span class="token operator">=</span> <span class="token function">map</span><span class="token punctuation">(</span>lightAnalogVal<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">4095.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">100.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="5"><li>Finally, we'll add the light level to our event payload.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code>String payload <span class="token operator">=</span> <span class="token string">&quot;{\&quot;temp\&quot;:&quot;</span> <span class="token operator">+</span> <span class="token function">String</span><span class="token punctuation">(</span>currentTemperature<span class="token punctuation">)</span>
    <span class="token operator">+</span> <span class="token string">&quot;, \&quot;humidity\&quot;:&quot;</span> <span class="token operator">+</span> <span class="token function">String</span><span class="token punctuation">(</span>currentHumidity<span class="token punctuation">)</span>
    <span class="token operator">+</span> <span class="token string">&quot;, \&quot;tvoc\&quot;:&quot;</span> <span class="token operator">+</span> <span class="token function">String</span><span class="token punctuation">(</span>currentTVOC<span class="token punctuation">)</span>
    <span class="token operator">+</span> <span class="token string">&quot;, \&quot;co2eq\&quot;:&quot;</span> <span class="token operator">+</span> <span class="token function">String</span><span class="token punctuation">(</span>currentCO2eq<span class="token punctuation">)</span>
    <span class="token operator">+</span> <span class="token string">&quot;, \&quot;dust\&quot;: {\&quot;lpo\&quot;:&quot;</span> <span class="token operator">+</span> <span class="token function">String</span><span class="token punctuation">(</span>lowPulseOccupancy<span class="token punctuation">)</span>
    <span class="token operator">+</span> <span class="token string">&quot;, \&quot;ratio\&quot;:&quot;</span> <span class="token operator">+</span> <span class="token function">String</span><span class="token punctuation">(</span>ratio<span class="token punctuation">)</span>
    <span class="token operator">+</span> <span class="token string">&quot;, \&quot;concentration\&quot;:&quot;</span> <span class="token operator">+</span> <span class="token function">String</span><span class="token punctuation">(</span>concentration<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;}&quot;</span>
    <span class="token operator">+</span> <span class="token string">&quot;, \&quot;lightLevel\&quot;:&quot;</span> <span class="token operator">+</span> <span class="token function">String</span><span class="token punctuation">(</span>currentLightLevel<span class="token punctuation">)</span>
    <span class="token operator">+</span> <span class="token string">&quot;}&quot;</span><span class="token punctuation">;</span>
</code></pre></div><ol start="6"><li>Flash the firmware and navigate back to the console. Shine a light towards the sensor and watch the value change.</li></ol><p><img src="/assets/img/lightLevels.db7a74bd.png" alt></p><p>One more sensor to go!</p><h2 id="working-with-the-motion-sensor"><a href="#working-with-the-motion-sensor" aria-hidden="true" class="header-anchor">#</a> Working with the Motion Sensor</h2><ol><li>Find the Motion sensor.</li></ol><p><img src="/assets/img/motionsensor.f8c25acb.jpg" alt></p><ol start="2"><li>The bag includes a sensor and a four-wire cable for connecting the sensor to the board. Plug the larger side of the cable into the slot on the sensor PCB.</li></ol><p><img src="/assets/img/motioncable.b1a9e035.jpg" alt></p><ol start="3"><li>Plug the other end into the white connector with the <code>D2</code> label next to it.</li></ol><p><img src="/assets/img/motionpluggedin.5e24a6f0.jpg" alt></p><p>Once connected, you're ready to start reading from this sensor!</p><p><img src="/assets/img/fivesensors.b6e02a82.jpg" alt></p><h3 id="interacting-with-the-device-triggering-an-event"><a href="#interacting-with-the-device-triggering-an-event" aria-hidden="true" class="header-anchor">#</a> Interacting with the device &amp; triggering an event</h3><ol><li>As with the previous two devices, we'll add a new <code>#define</code> for the pin mapping.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token macro property">#<span class="token directive keyword">define</span> MOTION_SENSOR_PIN D2</span>
</code></pre></div><ol start="2"><li>And add a <code>pinMode</code> initialization to the <code>setup</code></li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token function">pinMode</span><span class="token punctuation">(</span>MOTION_SENSOR_PIN<span class="token punctuation">,</span> INPUT<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="3"><li>Next, we'll read from the sensor in the <code>loop</code> function. Add the bottom, outside of the other <code>if</code> statement, add the following.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">digitalRead</span><span class="token punctuation">(</span>MOTION_SENSOR_PIN<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Particle<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token string">&quot;movement_detected&quot;</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> MY_DEVICES<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p><code>digitalRead</code> returns either a <code>LOW</code> (0) value or a <code>HIGH</code> (1). In the case of our motion sensor, <code>HIGH</code> means that movement was detected, so we'll fire an event to the Device cloud.</p></div><h3 id="adding-the-last-motion-time-to-our-event-payload"><a href="#adding-the-last-motion-time-to-our-event-payload" aria-hidden="true" class="header-anchor">#</a> Adding the last motion time to our event payload</h3><ol><li>We can also log the last time we detected motion and pass this along to our sensor payload. Start by adding a global variable at the top of the file.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">uint32_t</span> lastMotionTime<span class="token punctuation">;</span>
</code></pre></div><ol start="2"><li>Then, just after the <code>Particle.publish</code> we added above for &quot;motion_detected&quot;, use the <a href="https://docs.particle.io/reference/firmware/electron/#time" target="_blank" rel="noopener noreferrer"><code>Time</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> class to set the <code>lastMotionTime</code> variable.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code>lastMotionTime <span class="token operator">=</span> Time<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="3"><li>Finally, add the <code>lastMotionTime</code> to our sensor payload.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code>String payload <span class="token operator">=</span> <span class="token string">&quot;{\&quot;temp\&quot;:&quot;</span> <span class="token operator">+</span> <span class="token function">String</span><span class="token punctuation">(</span>currentTemperature<span class="token punctuation">)</span>
    <span class="token operator">+</span> <span class="token string">&quot;, \&quot;humidity\&quot;:&quot;</span> <span class="token operator">+</span> <span class="token function">String</span><span class="token punctuation">(</span>currentHumidity<span class="token punctuation">)</span>
    <span class="token operator">+</span> <span class="token string">&quot;, \&quot;tvoc\&quot;:&quot;</span> <span class="token operator">+</span> <span class="token function">String</span><span class="token punctuation">(</span>currentTVOC<span class="token punctuation">)</span>
    <span class="token operator">+</span> <span class="token string">&quot;, \&quot;co2eq\&quot;:&quot;</span> <span class="token operator">+</span> <span class="token function">String</span><span class="token punctuation">(</span>currentCO2eq<span class="token punctuation">)</span>
    <span class="token operator">+</span> <span class="token string">&quot;, \&quot;dust\&quot;: {\&quot;lpo\&quot;:&quot;</span> <span class="token operator">+</span> <span class="token function">String</span><span class="token punctuation">(</span>lowPulseOccupancy<span class="token punctuation">)</span>
    <span class="token operator">+</span> <span class="token string">&quot;, \&quot;ratio\&quot;:&quot;</span> <span class="token operator">+</span> <span class="token function">String</span><span class="token punctuation">(</span>ratio<span class="token punctuation">)</span>
    <span class="token operator">+</span> <span class="token string">&quot;, \&quot;concentration\&quot;:&quot;</span> <span class="token operator">+</span> <span class="token function">String</span><span class="token punctuation">(</span>concentration<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;}&quot;</span>
    <span class="token operator">+</span> <span class="token string">&quot;, \&quot;lightLevel\&quot;:&quot;</span> <span class="token operator">+</span> <span class="token function">String</span><span class="token punctuation">(</span>currentLightLevel<span class="token punctuation">)</span>
    <span class="token operator">+</span> <span class="token string">&quot;, \&quot;lastMotion\&quot;:&quot;</span> <span class="token operator">+</span> <span class="token function">String</span><span class="token punctuation">(</span>lastMotionTime<span class="token punctuation">)</span>
    <span class="token operator">+</span> <span class="token string">&quot;}&quot;</span><span class="token punctuation">;</span>
</code></pre></div><ol start="4"><li>Flash the firmware to your device and re-open device dashboard in the console. Wave your hand over the sensor to trigger an event.</li></ol><p><img src="/assets/img/motionsensor.a23c1c95.gif" alt></p><p>When a new sensor event comes in, you'll also see the <code>lastMotion</code> property included.</p><p><img src="/assets/img/motionevent.b9f2d398.png" alt></p><p>With that, we've wired up all of our sensors and are posting values to the cloud. You're getting to be a Particle pro now! Let's explore integrating our device with 3rd party services and getting our data into the Azure cloud.</p></div><div class="page-edit"><div class="edit-link"><a href="https://github.com/particle-iot/workshop-continental-tire/edit/master/docs/ch2.md" target="_blank" rel="noopener noreferrer">Help us improve this page!</a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div><!----></div><div class="page-nav"><p class="inner"><span class="prev">
        ← <a href="/docs/ch1.html" class="prev">
          Chapter 1: Getting your Electron device online
        </a></span><span class="next"><a href="/docs/ch3.html">
          Chapter 3: Using IFTTT &amp; Azure IoT Hub
        </a> →
      </span></p></div></div></div></div>
    <script src="/assets/js/1.a58f505a.js" defer></script><script src="/assets/js/app.5353aa60.js" defer></script>
  </body>
</html>
