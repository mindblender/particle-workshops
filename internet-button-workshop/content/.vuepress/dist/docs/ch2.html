<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Chapter 2: Blinking lights and buttons! | Particle Blinky Onboarding</title>
    <meta name="description" content="Internet-Button (Photon) onboarding session designed to teach the basics of building for the Particle ecosystem.">
    
    
    <link rel="preload" href="/assets/css/5.styles.99013215.css" as="style"><link rel="preload" href="/assets/js/app.80c7ad9a.js" as="script"><link rel="preload" href="/assets/js/1.052b85cc.js" as="script"><link rel="prefetch" href="/assets/js/0.eb9a7995.js"><link rel="prefetch" href="/assets/js/2.631168a3.js"><link rel="prefetch" href="/assets/js/3.6dad6a1d.js"><link rel="prefetch" href="/assets/js/4.19cea21d.js">
    <link rel="stylesheet" href="/assets/css/5.styles.99013215.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><!----><span class="site-name">
      Particle Blinky Onboarding
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="http://particle.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Team
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><a href="https://github.com/particle-iot/internet-button-workshop" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="http://particle.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Team
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><a href="https://github.com/particle-iot/internet-button-workshop" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav><ul class="sidebar-links"><li><a href="/docs/" class="sidebar-link">About The Blinky Onboarding</a></li><li><a href="/docs/ch1.html" class="sidebar-link">Chapter 1: Claiming your device</a></li><li><a href="/docs/ch2.html" class="active sidebar-link">Chapter 2: Blinking lights and buttons!</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/ch2.html#create-a-new-project-in-the-web-ide" class="sidebar-link">Create a new project in the Web IDE</a></li><li class="sidebar-sub-header"><a href="/docs/ch2.html#install-the-internet-button-library" class="sidebar-link">Install the Internet Button Library</a></li><li class="sidebar-sub-header"><a href="/docs/ch2.html#the-setup-and-loop-functions" class="sidebar-link">The setup() and loop() functions</a></li><li class="sidebar-sub-header"><a href="/docs/ch2.html#light-up-an-led" class="sidebar-link">Light up an LED</a></li><li class="sidebar-sub-header"><a href="/docs/ch2.html#light-up-an-led-on-a-button-press" class="sidebar-link">Light up an LED on a button press</a></li><li class="sidebar-sub-header"><a href="/docs/ch2.html#using-particle-primitives-to-control-leds" class="sidebar-link">Using Particle Primitives to control LEDs</a></li></ul></li><li><a href="/docs/ch3.html" class="sidebar-link">Chapter 3: The product dashboard and Particle rules engine</a></li></ul></div><div class="page"><div class="content"><h1 id="chapter-2-blinking-lights-and-buttons"><a href="#chapter-2-blinking-lights-and-buttons" aria-hidden="true" class="header-anchor">#</a> Chapter 2: Blinking lights and buttons!</h1><table><thead><tr><th><strong>Project Goal</strong></th><th>Start programming your Photon and Internet Button.</th></tr></thead><tbody><tr><td><strong>What you’ll learn</strong></td><td>How to install libraries, using the Web IDE to flash devices, lighting up button LEDs and responding to button presses.</td></tr><tr><td><strong>Tools you’ll need</strong></td><td>build.particle.io, a Particle Internet button.</td></tr><tr><td><strong>Time needed to complete</strong></td><td>20 minutes</td></tr></tbody></table><p>In this session, we're going to start exploring the Particle ecosystem with the help of the Photon-based Internet Button, a small device that's jam-packed with RGB LEDs, four buttons, an accelerometer and a buzzer for emitting tones.</p><p>If you get stuck at any point in this process and need help, <a href="https://go.particle.io/shared_apps/5b7b7bd3ce03480428000a26" target="_blank" rel="noopener noreferrer">click here<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> for the completed application.</p><h2 id="create-a-new-project-in-the-web-ide"><a href="#create-a-new-project-in-the-web-ide" aria-hidden="true" class="header-anchor">#</a> Create a new project in the Web IDE</h2><ol><li>Navigate to <a href="http://build.particle.io" target="_blank" rel="noopener noreferrer">build.particle.io<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. You may need to log-in, if prompted.</li></ol><p><img src="/assets/img/login.612397f2.png" alt></p><ol start="2"><li>Once you log-in, you may be directed to the Particle home page. If so, <a href="https://build.particle.io" target="_blank" rel="noopener noreferrer">click here to navigate<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> back to Particle Build.</li></ol><p><img src="/assets/img/particle-home.a4565b9c.png" alt></p><ol start="3"><li>When navigating to the Web IDE (Build), the first thing you'll see is an empty editor window for a new project and a prompt to give that project a name.</li></ol><p><img src="/assets/img/newproject.68e3a433.png" alt></p><ol start="4"><li>In the Current App textbox, give your app the name &quot;MyInternetButton&quot; and hit enter.</li></ol><p><img src="/assets/img/projectname.92546e59.png" alt></p><ol start="5"><li>Once you've given your project a name, you're ready to code!</li></ol><p><img src="/assets/img/projectnamed.855d0b5e.png" alt></p><h2 id="install-the-internet-button-library"><a href="#install-the-internet-button-library" aria-hidden="true" class="header-anchor">#</a> Install the Internet Button Library</h2><p>Before we access the sensors and LEDs on your Internet Button, we need to install the Internet Button library. This is a Particle-managed library that provides a set of simple abstractions for working with the Internet Button, from detection motion and orientation to playing light animations.</p><ol><li>In the Build IDE. Click the library icon to open the libraries tab.</li></ol><p><img src="/assets/img/librariesicon.cda73ad7.png" alt></p><ol start="2"><li>Choose the &quot;Internet Button&quot; library from the popular list (it will appear at the top).</li></ol><p><img src="/assets/img/librarieslist.c5c0ba1c.png" alt></p><ol start="3"><li>Click &quot;Include in Project.&quot;</li></ol><p><img src="/assets/img/includeinproject.834bad4c.png" alt></p><ol start="4"><li>Select your &quot;MyInternetButton&quot; project from the list. Click &quot;Confirm&quot; when prompted.</li></ol><p><img src="/assets/img/pickapp.52224e56.png" alt></p><p><img src="/assets/img/confirmapp.574ed6da.png" alt></p><ol start="5"><li>Once the library is included, you'll see it in your list of included libraries, as well as a <code>#include</code> statement at the top of your project source.</li></ol><p><img src="/assets/img/fileinclude.6a2e009b.png" alt></p><p>Now that we have the library, let's blink an LED.</p><h2 id="the-setup-and-loop-functions"><a href="#the-setup-and-loop-functions" aria-hidden="true" class="header-anchor">#</a> The <code>setup()</code> and <code>loop()</code> functions</h2><p>Before we dive into our first bit of code, a brief word about the two functions that were auto-populated into your new app. If you've done Arduino or Particle development before, you're already familiar with these and can skip ahead. If not, read on.</p><p>Every Particle application <em>must</em> have two functions in the main file (sometimes called a &quot;sketch&quot;): <code>setup()</code> and <code>loop()</code>. Both of these functions are called by the Particle Device OS.</p><p>True to its name, <code>setup()</code> runs only only once when the device starts up and is used for initializing buttons, sensors and other things needed to get your project ready to execute.</p><p><code>loop()</code>, on the other hand, runs over and over again as long as your firmware is running on the device. When the function is called by the device OS, the code inside executes sequentially until it reaches the closing brace of the function, before being called again.</p><p>While the speed at which the <code>loop()</code> function executes is determined by the specific hardware and the time needed to execute the use code you've written in the function, it's important to know that, much of the time, this function will run very fast.</p><p>The bulk of your program, from state management, handling user input, reading from sensors and more will take place inside of the <code>loop()</code> function. It can take a bit of getting used to if you're not familiar with this style of development, but once you become comfortable, you'll enjoy the power this control provides you as a firmware developer.</p><h2 id="light-up-an-led"><a href="#light-up-an-led" aria-hidden="true" class="header-anchor">#</a> Light up an LED</h2><ol><li>To access the LEDs on the Internet button, we'll use the <code>InternetButton</code> object. Let's start by creating an instance before the <code>setup()</code> function</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code>InternetButton btn <span class="token operator">=</span> <span class="token function">InternetButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="2"><li>Now, inside of the <code>setup()</code> function, we'll initialize the button.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code>btn<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="3"><li>The Internet Button is ringed by 11 Red-Green-Blue (RGB) LEDs. The LEDs are numbered clockwise 1-11, starting to the left of the Photon with the USB connector facing up.</li></ol><p><img src="/assets/img/buttonshot.79f65292.jpg" alt></p><ol start="4"><li>To turn on an individual LED, we use the <code>ledOn</code> method of the <code>InternetButton</code> class. This method takes the numeric position of an LED to turn on (1-11) and three integer values representing the amount of red, blue and green to &quot;turn on.&quot; Each value must be between 0 (off) and 255 (completely on). Let's turn on the LEDs at the 3 o'clock, 6 o'clock and 9 o'clock positions. Add the following to the <code>loop</code> function.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code>btn<span class="token punctuation">.</span><span class="token function">ledOn</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Red</span>
btn<span class="token punctuation">.</span><span class="token function">ledOn</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Green</span>
btn<span class="token punctuation">.</span><span class="token function">ledOn</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Blue</span>
</code></pre></div><ol start="5"><li>We want to blink these lights, so we'll need to turn them off. If we add the off commands right after the previous code, the lights will strobe very rapidly. We can slow things down by using the <code>delay</code> command, which tells the Photon to pause execution for a certain number of milliseconds. Add the following below the <code>ledOn</code> lines to delay the program for one second (1000 milliseconds).</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="6"><li>Next, we'll turn the LEDs off. The <code>ledOff</code> command takes just the position of the LED you want to turn off. Add the following after the <code>delay</code>. Notice we added another <code>delay</code> after turning all the LEDs off. Since the <code>loop</code> function repeats as soon as execution is complete, this gives us another pause before the lights turn back on.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code>btn<span class="token punctuation">.</span><span class="token function">ledOff</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
btn<span class="token punctuation">.</span><span class="token function">ledOff</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
btn<span class="token punctuation">.</span><span class="token function">ledOff</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="7"><li>Now let's flash this code. In the lower right of the web IDE, you'll see either the name of a device or the message &quot;no device selected.&quot; Click to open up the devices tab.</li></ol><p><img src="/assets/img/selectdevice.9e4565a9.png" alt></p><ol start="8"><li>In the devices tab, click the star next to your Internet Button to select it.</li></ol><p><img src="/assets/img/deviceslist.3f424928.png" alt></p><ol start="9"><li>Now, to flash your device, click the lightning bolt in the upper left corner of the Web IDE.</li></ol><p><img src="/assets/img/flashdevice.5839932a.png" alt></p><ol start="10"><li>After a few moments, your Internet Button should reset and you'll be greeted by blinking lights!</li></ol><p><img src="/assets/img/blinkyleds.c5ae16d4.gif" alt></p><h2 id="light-up-an-led-on-a-button-press"><a href="#light-up-an-led-on-a-button-press" aria-hidden="true" class="header-anchor">#</a> Light up an LED on a button press</h2><p>The Particle Internet Button also has four buttons mounted on the back, under the 12, 3, 6 and 9 o'clock positions. For this next exercise, let's light up an LED when a button is pressed.</p><p><img src="/assets/img/buttons.e94e5240.jpg" alt></p><ol><li>In the <code>loop</code> function, remove the code from the last exercise and add the following.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">if</span><span class="token punctuation">(</span>btn<span class="token punctuation">.</span><span class="token function">buttonOn</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  btn<span class="token punctuation">.</span><span class="token function">ledOn</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span> <span class="token punctuation">{</span>
  btn<span class="token punctuation">.</span><span class="token function">ledOff</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>This time, instead of turning on the LEDs based on a delay, we'll do so when the button underneath is pressed. The button underneath the 3 o'clock LED is #2, so we'll call the <code>buttonOn</code> method and pass in the number 2. If the button is currently being pressed, this will return true and we'll light up the LED. Otherwise, we'll turn the LED off.</p><ol start="2"><li>Now, let's do the same for the two buttons underneath the 6 o'clock and 9 o'clock LEDs.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">if</span><span class="token punctuation">(</span>btn<span class="token punctuation">.</span><span class="token function">buttonOn</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  btn<span class="token punctuation">.</span><span class="token function">ledOn</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span> <span class="token punctuation">{</span>
  btn<span class="token punctuation">.</span><span class="token function">ledOff</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span><span class="token punctuation">(</span>btn<span class="token punctuation">.</span><span class="token function">buttonOn</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  btn<span class="token punctuation">.</span><span class="token function">ledOn</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span> <span class="token punctuation">{</span>
  btn<span class="token punctuation">.</span><span class="token function">ledOff</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="3"><li>Click the lightning bolt to flash the latest code. Once finished, try clicking the buttons and be amazed as the LEDs respond!</li></ol><p><img src="/assets/img/buttonblink.3c511ac2.gif" alt></p><ol start="4"><li>Before we move on, let's look at an LED animation. Add the following two lines to the end of your <code>setup</code> function and flash the firmware again. What do you see?</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code>btn<span class="token punctuation">.</span><span class="token function">rainbow</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
btn<span class="token punctuation">.</span><span class="token function">allLedsOff</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="using-particle-primitives-to-control-leds"><a href="#using-particle-primitives-to-control-leds" aria-hidden="true" class="header-anchor">#</a> Using Particle Primitives to control LEDs</h2><p>We've controlled our Internet Button LEDs on delays and button-presses, which is great. But this is an Internet Button, so let's put some Internet all up in it!</p><ol><li>First, we need some variables to hold the state of our LEDs. Add these three lines to the top of the file, just after the <code>#include</code>.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">bool</span> isThreeOn <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token keyword">bool</span> isSixOn <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token keyword">bool</span> isNineOn <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
</code></pre></div><ol start="2"><li>Now, let's add a function to toggle our 3, 6, and 9 o'clock LEDs. This function will be used by the <code>Particle.function()</code> primitive.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">toggleLED</span><span class="token punctuation">(</span>String command<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>command <span class="token operator">==</span> <span class="token string">&quot;3&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    isThreeOn <span class="token operator">=</span> <span class="token operator">!</span>isThreeOn<span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>command <span class="token operator">==</span> <span class="token string">&quot;6&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    isSixOn <span class="token operator">=</span> <span class="token operator">!</span>isSixOn<span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>command <span class="token operator">==</span> <span class="token string">&quot;9&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    isNineOn <span class="token operator">=</span> <span class="token operator">!</span>isNineOn<span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>When the function is called, a command will be passed specifying which LED to light up. Based on the value, we'll toggle the boolean state variable we specified at the top of the file.</p><ol start="3"><li>To let the Particle device cloud know about our variables and functions, we need to specify them in our <code>setup</code> function. Add the following to the start of <code>setup</code>.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code>Particle<span class="token punctuation">.</span><span class="token function">variable</span><span class="token punctuation">(</span><span class="token string">&quot;threeOn&quot;</span><span class="token punctuation">,</span> isThreeOn<span class="token punctuation">)</span><span class="token punctuation">;</span>
Particle<span class="token punctuation">.</span><span class="token function">variable</span><span class="token punctuation">(</span><span class="token string">&quot;sixOn&quot;</span><span class="token punctuation">,</span> isSixOn<span class="token punctuation">)</span><span class="token punctuation">;</span>
Particle<span class="token punctuation">.</span><span class="token function">variable</span><span class="token punctuation">(</span><span class="token string">&quot;nineOn&quot;</span><span class="token punctuation">,</span> isNineOn<span class="token punctuation">)</span><span class="token punctuation">;</span>

Particle<span class="token punctuation">.</span><span class="token function">function</span><span class="token punctuation">(</span><span class="token string">&quot;toggleLED&quot;</span><span class="token punctuation">,</span> toggleLED<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="4"><li>Finally, we need to use our state variables to light up the LEDs. Change the <code>loop</code> function from the last exercise to check for our state variables and a button press. The final result should look like this.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">if</span><span class="token punctuation">(</span>btn<span class="token punctuation">.</span><span class="token function">buttonOn</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">||</span> isThreeOn<span class="token punctuation">)</span><span class="token punctuation">{</span>
  btn<span class="token punctuation">.</span><span class="token function">ledOn</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span> <span class="token punctuation">{</span>
  btn<span class="token punctuation">.</span><span class="token function">ledOff</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span><span class="token punctuation">(</span>btn<span class="token punctuation">.</span><span class="token function">buttonOn</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">||</span> isSixOn<span class="token punctuation">)</span><span class="token punctuation">{</span>
  btn<span class="token punctuation">.</span><span class="token function">ledOn</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span> <span class="token punctuation">{</span>
  btn<span class="token punctuation">.</span><span class="token function">ledOff</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span><span class="token punctuation">(</span>btn<span class="token punctuation">.</span><span class="token function">buttonOn</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">||</span> isNineOn<span class="token punctuation">)</span><span class="token punctuation">{</span>
  btn<span class="token punctuation">.</span><span class="token function">ledOn</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span> <span class="token punctuation">{</span>
  btn<span class="token punctuation">.</span><span class="token function">ledOff</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="5"><li>Flash the latest firmware and, after your device has restarted, navigate to <a href="https://console.particle.io" target="_blank" rel="noopener noreferrer">console.particle.io<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. Select your device.</li></ol><p><img src="/assets/img/consolelist.46f0f122.png" alt></p><ol start="6"><li>On the right side, you'll see the list of variables and functions. If you click &quot;Get&quot; on the variables, you should see a return value of <code>false</code>.</li></ol><p><img src="/assets/img/deviceprimitives.7dadff0c.png" alt></p><ol start="7"><li>Enter &quot;3&quot; in the input box under <code>toggleLED</code> and click &quot;Call&quot;. A red LED should light and a value of 1 returned. If you click on &quot;Get&quot; for <code>threeOn</code> again, the return value should now be <code>true</code>.</li></ol><p><img src="/assets/img/ledactivated.f9bca918.png" alt></p><ol start="8"><li>Before we move on, let's explore one last primitive, <code>Particle.subscribe()</code>. Add the following line to your <code>setup</code> function.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code>Particle<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">&quot;toggleAll&quot;</span><span class="token punctuation">,</span> toggleAll<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>What we're doing here is telling the Particle cloud to look for events with the name <code>toggleAll</code> and, when these are fired, to call a handler function on our device.</p><ol start="9"><li>Add the handler function, before the <code>setup</code> function</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">toggleAll</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>event<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>areAllOn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    btn<span class="token punctuation">.</span><span class="token function">allLedsOff</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    btn<span class="token punctuation">.</span><span class="token function">allLedsOn</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  areAllOn <span class="token operator">=</span> <span class="token operator">!</span>areAllOn<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>We're checking the state of another boolean, here. If its true, we'll turn all the Internet Button LEDs off. Otherwise, we'll turn them on. Finally, we change the value of the boolean.</p><ol start="10"><li>Speaking of that boolean, we need to add it to the top of our file, near the other state variables.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">bool</span> areAllOn <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
</code></pre></div><ol start="11"><li>Flash the firmware to your device and wait for it to restart. Then, navigate back to the Console and look for the &quot;Publish Event&quot; button just above the event list.</li></ol><p><img src="/assets/img/publishEvent.7b6b4c0b.png" alt></p><ol start="12"><li>Click the button and enter &quot;toggleAll&quot; for the event name. Select the &quot;Public&quot; radio button and click &quot;Publish.&quot;</li></ol><p><img src="/assets/img/toggleAll.01937144.png" alt></p><ol start="13"><li>If everything worked correctly, you should see a ring of white lights around your Internet Button.</li></ol><p><img src="/assets/img/allOn.3f2df271.jpg" alt></p><p>Now we have a true Internet Button! Next up, let's explore some enterprise features that allow our buttons to work together!</p></div><div class="page-edit"><div class="edit-link"><a href="https://github.com/particle-iot/internet-button-workshop/edit/master/docs/ch2.md" target="_blank" rel="noopener noreferrer">Help us improve this page!</a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div><!----></div><div class="page-nav"><p class="inner"><span class="prev">
        ← <a href="/docs/ch1.html" class="prev">
          Chapter 1: Claiming your device
        </a></span><span class="next"><a href="/docs/ch3.html">
          Chapter 3: The product dashboard and Particle rules engine
        </a> →
      </span></p></div></div></div></div>
    <script src="/assets/js/1.052b85cc.js" defer></script><script src="/assets/js/app.80c7ad9a.js" defer></script>
  </body>
</html>
